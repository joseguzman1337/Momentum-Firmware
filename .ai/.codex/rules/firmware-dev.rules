# Codex Rules for Momentum Firmware Development
# Allows firmware build and development commands to run outside sandbox

# Allow firmware build tool (fbt) commands
prefix_rule(
    pattern = ["./fbt"],
    decision = "allow",
    match = [
        "./fbt flash_usb_full",
        "./fbt updater_package",
        "./fbt launch APPSRC=your_appid",
        "./fbt build"
    ]
)

# Allow git operations for version control
prefix_rule(
    pattern = ["git"],
    decision = "allow",
    match = [
        "git status",
        "git add .",
        "git commit -m 'message'",
        "git push origin main",
        "git pull",
        "git checkout -b feature-branch"
    ]
)

# Allow GitHub CLI for PR management
prefix_rule(
    pattern = ["gh", "pr"],
    decision = "allow",
    match = [
        "gh pr create",
        "gh pr merge",
        "gh pr view",
        "gh pr list"
    ]
)

# Allow Python package management
prefix_rule(
    pattern = ["pip", "install"],
    decision = "prompt",
    match = [
        "pip install -r requirements.txt",
        "pip install pytest"
    ]
)

# Allow make commands for build system
prefix_rule(
    pattern = ["make"],
    decision = "allow",
    match = [
        "make clean",
        "make all",
        "make install"
    ]
)

# Allow firmware flashing tools
prefix_rule(
    pattern = ["dfu-util"],
    decision = "prompt",
    match = [
        "dfu-util -a 0 -s 0x08000000 -D firmware.bin"
    ]
)

# Allow file operations for asset management
prefix_rule(
    pattern = ["cp"],
    decision = "allow"
)

prefix_rule(
    pattern = ["mv"],
    decision = "allow"
)

prefix_rule(
    pattern = ["mkdir"],
    decision = "allow"
)

# Allow archive operations for asset packs
prefix_rule(
    pattern = ["tar"],
    decision = "allow",
    match = [
        "tar -xzf asset_pack.tar.gz",
        "tar -czf asset_pack.tar.gz assets/"
    ]
)

prefix_rule(
    pattern = ["unzip"],
    decision = "allow"
)

# Allow text processing for configuration
prefix_rule(
    pattern = ["sed"],
    decision = "allow"
)

prefix_rule(
    pattern = ["awk"],
    decision = "allow"
)

# Allow file inspection
prefix_rule(
    pattern = ["cat"],
    decision = "allow"
)

prefix_rule(
    pattern = ["less"],
    decision = "allow"
)

prefix_rule(
    pattern = ["head"],
    decision = "allow"
)

prefix_rule(
    pattern = ["tail"],
    decision = "allow"
)