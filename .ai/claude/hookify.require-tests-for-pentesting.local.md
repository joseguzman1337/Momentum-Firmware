---
name: require-tests-for-pentesting
enabled: true
event: file
conditions:
  - field: file_path
    operator: regex_match
    pattern: /src/pentesting/.*\.py$
  - field: new_text
    operator: regex_match
    pattern: def\s+\w+\(
  - field: old_text
    operator: not_contains
    pattern: def\s+\w+\(
---

ðŸ“‹ **NEW PENTESTING CODE DETECTED - TEST REMINDER**

You're adding a new function to pentesting tools.

**File:** `{file_path}`

**Repository policy** (per CLAUDE.md Security Context):
This is a cybersecurity training/research repository. All pentesting tools must be thoroughly tested to ensure:
- Ethical use constraints are enforced
- No unintended damage to systems
- Accurate security scanning results
- Proper error handling for edge cases

**Testing requirements:**

1. **Create unit test** (pytest):
   ```bash
   cd /src/pentesting/1nsp3ct3r/core
   # Create test file: test_<module_name>.py
   ```

2. **Use pytest markers** (from pytest.ini):
   ```python
   import pytest

   @pytest.mark.unit
   @pytest.mark.security
   def test_your_function():
       # Test authorized use case
       # Test error handling
       # Test input validation
   ```

3. **Run tests**:
   ```bash
   python3 -m pytest -v
   pytest -m "security and unit" -v  # Selective run
   ```

**Available pytest markers:**
- `@pytest.mark.unit` - Pure logic tests
- `@pytest.mark.security` - Security-critical tests
- `@pytest.mark.integration` - API/system integration
- `@pytest.mark.smoke` - Quick health checks

**Example test pattern:**
```python
def test_exploit_requires_authorization():
    """Ensure exploit tools require explicit authorization"""
    with pytest.raises(AuthorizationError):
        run_exploit(target="example.com", authorized=False)
```

This is a reminder, not a blocker. Proceed if you'll add tests after implementation.
